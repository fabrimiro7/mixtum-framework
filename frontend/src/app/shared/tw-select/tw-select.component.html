<div class="relative">
  <button
    #trigger
    #origin="cdkOverlayOrigin"
    type="button"
    class="tw-select-trigger"
    [attr.aria-expanded]="open"
    [attr.aria-disabled]="disabled"
    [disabled]="disabled"
    cdkOverlayOrigin
    (click)="toggle()"
    (keydown)="onTriggerKeydown($event)"
  >
    <span class="tw-select-selected">
      <span class="block truncate" [class.text-gray-500]="!hasSelection">{{ displayLabel }}</span>
    </span>
    <svg viewBox="0 0 16 16" fill="currentColor" data-slot="icon" aria-hidden="true" class="tw-select-icon">
      <path d="M5.22 10.22a.75.75 0 0 1 1.06 0L8 11.94l1.72-1.72a.75.75 0 1 1 1.06 1.06l-2.25 2.25a.75.75 0 0 1-1.06 0l-2.25-2.25a.75.75 0 0 1 0-1.06ZM10.78 5.78a.75.75 0 0 1-1.06 0L8 4.06 6.28 5.78a.75.75 0 0 1-1.06-1.06l2.25-2.25a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1 0 1.06Z" clip-rule="evenodd" fill-rule="evenodd" />
    </svg>
  </button>

  <ng-template
    cdkConnectedOverlay
    [cdkConnectedOverlayOrigin]="origin"
    [cdkConnectedOverlayOpen]="open"
    [cdkConnectedOverlayHasBackdrop]="true"
    cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
    [cdkConnectedOverlayWidth]="overlayWidth"
    (backdropClick)="close()"
    (detach)="close()"
  >
    <div
      class="tw-select-panel"
      [style.--button-width.px]="overlayWidth"
      role="listbox"
      [attr.aria-multiselectable]="multiple"
    >
      <div *ngIf="!items?.length" class="tw-select-empty">Nessuna opzione</div>
      <button
        type="button"
        class="tw-select-option group/option"
        *ngFor="let item of items; let i = index"
        role="option"
        [attr.aria-selected]="isSelected(item)"
        [class.tw-select-option-active]="i === activeIndex"
        (click)="selectItem(item)"
        (mouseenter)="setActiveIndex(i)"
      >
        <div class="flex items-center">
          <span class="tw-select-option-label block truncate font-normal">
            {{ getItemLabel(item) }}
          </span>
        </div>
        <span *ngIf="isSelected(item)" class="tw-select-check">
          <svg viewBox="0 0 20 20" fill="currentColor" data-slot="icon" aria-hidden="true" class="size-5">
            <path d="M16.704 4.153a.75.75 0 0 1 .143 1.052l-8 10.5a.75.75 0 0 1-1.127.075l-4.5-4.5a.75.75 0 0 1 1.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 0 1 1.05-.143Z" clip-rule="evenodd" fill-rule="evenodd" />
          </svg>
        </span>
      </button>
    </div>
  </ng-template>
</div>
