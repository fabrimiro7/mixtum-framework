<div class="mx-auto max-w-5xl px-6 py-8" *ngIf="template">
  <div class="flex flex-wrap items-center justify-between gap-4">
    <div>
      <h1 class="text-2xl font-semibold text-slate-900">Editor Template</h1>
      <p class="text-sm text-slate-500">Gestisci blocchi e snapshot del template.</p>
    </div>
    <app-workspace-selector></app-workspace-selector>
  </div>

  <form [formGroup]="templateForm" class="mt-6 tw-form-stack">
    <div class="tw-field">
      <label class="tw-label">Titolo</label>
      <input
        type="text"
        formControlName="title"
        class="tw-input"
      />
    </div>
    <div class="tw-field">
      <label class="tw-label">Descrizione</label>
      <textarea
        rows="3"
        formControlName="description"
        class="tw-textarea"
      ></textarea>
    </div>
    <div class="flex justify-end">
      <button
        type="button"
        class="rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800"
        (click)="saveTemplate()"
      >
        Salva Template
      </button>
    </div>
  </form>

  <div class="mt-8 border-t border-slate-200 pt-6">
    <div class="flex flex-wrap items-center justify-between gap-3">
      <div>
        <h2 class="text-lg font-semibold text-slate-900">Blocchi Template</h2>
        <p class="text-xs text-slate-400">Modifica il contenuto dei blocchi snapshot.</p>
      </div>
      <div class="flex flex-wrap items-center gap-2">
        <app-tw-select
          [(ngModel)]="selectedLibraryBlockId"
          [ngModelOptions]="{standalone: true}"
          [items]="blocksLibrary"
          bindValue="id"
          bindLabel="title"
          placeholder="Seleziona blocco library"
        ></app-tw-select>
        <button
          type="button"
          class="rounded-lg border border-slate-200 px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50"
          (click)="addTemplateBlock()"
        >
          Aggiungi blocco
        </button>
      </div>
    </div>

    <div class="mt-4">
      <app-notion-block-editor
        [(ngModel)]="templateBlocks"
        [ngModelOptions]="{standalone: true}"
        [allowInsert]="false"
        (blockDeleted)="onTemplateBlockDeleted($event)"
      ></app-notion-block-editor>
    </div>

    <div class="mt-4">
      <button
        type="button"
        class="rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800"
        (click)="saveTemplateBlocks()"
        [disabled]="savingBlocks"
      >
        Salva Blocchi
      </button>
    </div>
  </div>

  <div class="mt-10 border-t border-slate-200 pt-6">
    <h2 class="text-lg font-semibold text-slate-900">Block Library</h2>

    <form [formGroup]="newBlockForm" class="mt-4 tw-form-stack" (ngSubmit)="createBlock()">
      <div class="tw-field">
        <label class="tw-label">Titolo</label>
        <input
          type="text"
          formControlName="title"
          class="tw-input"
        />
      </div>
      <div class="tw-field">
        <label class="tw-label">Contenuto</label>
        <textarea
          rows="4"
          formControlName="content"
          class="tw-textarea"
        ></textarea>
      </div>
      <div class="flex justify-end">
        <button type="submit" class="rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white hover:bg-slate-800">
          Crea Blocco
        </button>
      </div>
    </form>

    <div class="mt-6 space-y-4">
      <div class="rounded-lg border border-slate-200 bg-white p-4" *ngFor="let block of blocksLibrary">
        <div class="space-y-3">
          <input
            type="text"
            class="tw-input"
            [(ngModel)]="block.title"
            [ngModelOptions]="{standalone: true}"
          />
          <textarea
            rows="3"
            class="tw-textarea"
            [(ngModel)]="block.content"
            [ngModelOptions]="{standalone: true}"
          ></textarea>
        </div>
        <div class="mt-3 flex justify-end gap-2">
          <button
            type="button"
            class="rounded-lg border border-slate-200 px-3 py-1.5 text-sm font-semibold text-slate-700 hover:bg-slate-50"
            (click)="saveLibraryBlock(block)"
          >
            Salva
          </button>
          <button
            type="button"
            class="rounded-lg border border-red-200 px-3 py-1.5 text-sm font-semibold text-red-600 hover:bg-red-50"
            (click)="deleteLibraryBlock(block)"
          >
            Elimina
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!template" class="px-6 py-8 text-sm text-slate-500">
  Template non trovato.
</div>
